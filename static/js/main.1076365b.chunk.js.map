{"version":3,"sources":["components/img/svg/aviasales-logo.svg","components/header/index.js","components/header/header.js","components/filter/index.js","components/filter/filter.js","components/sort/index.js","components/sort/sort.js","components/tickets/tickets.js","components/tickets/index.js","components/ticket-loader/loader.js","components/ticket-loader/tickets-loader.js","services/aviasales-services.js","components/app/index.js","components/app/app.js","index.js"],"names":["Header","className","href","src","logo","alt","Filter","filterData","onFilterClick","loading","items","map","title","index","checked","onClick","classNames","Tabs","sortData","onSortClick","undefined","Ticket","price","carrierLogo","segments","class","segment","Segment","route","time","duration","stopsHeader","stops","join","Tickets","tickets","ticket","Loader","props","speed","width","height","viewBox","backgroundColor","foregroundColor","x","y","rx","ry","TicketsLoader","count","Array","e","i","AviasalesServices","__apiBase","url","a","fetch","this","res","status","stop","ok","Error","json","getResource","searchId","getSearchId","getTicketPortion","portion","filter","value","Object","keys","length","filters","sort","getRawTickets","forEach","filtered","every","stopCount","sortFunction","find","slice","_transformTicket","arStopCountHeader","toLocaleString","carrier","departureTime","Date","date","arrivalTime","setMinutes","getMinutes","origin","destination","toLocaleTimeString","timeStyle","Math","floor","App","aviasalesServices","state","b","reduce","prev","cur","setFilter","setState","prevState","item","setSort","getTickets","prevProps","JSON","stringify","getProcessedTickets","then","Component","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.1076365b.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/aviasales-logo.2a735bae.svg\";","import Header from './header'\r\nexport default Header","import React from 'react';\r\n\r\nimport './header.css'\r\nimport logo from '../img/svg/aviasales-logo.svg';\r\n\r\nconst Header = () => {\r\n    return (\r\n        <header className=\"header\">\r\n            <div className=\"header__logo\">\r\n                <a href=\"/\" className=\"header__logo-link\">\r\n                    <img src={logo} alt=\"Aviasales\" className=\"header__logo-pic\" />\r\n                </a>\r\n            </div>\r\n        </header>\r\n    )\r\n};\r\nexport default Header;","import Filter from './filter'\r\n\r\nexport default Filter","import React from 'react'\r\n\r\nimport './filter.css'\r\n\r\n\r\nexport default function Filter({ filterData, onFilterClick, loading }) {\r\n    const renderFilterItems = () => {\r\n\r\n        return filterData.map(({ title, index, checked }) => {\r\n            return (\r\n                <li\r\n                    className={`filter__item ${checked ? \"checked\" : \"\"}`}\r\n                    onClick={() => onFilterClick(index)}\r\n                    key={index}\r\n                >\r\n                    {title}\r\n                </li>\r\n            )\r\n        })\r\n    }\r\n\r\n    const items = renderFilterItems()\r\n    let classNames = (loading) ? 'filter disable' : 'filter'\r\n    return (\r\n\r\n        <aside className={classNames}>\r\n            <h1 className=\"filter__header\">\r\n                Количество пересадок\r\n                </h1>\r\n            <ul className=\"filter__options\">\r\n                {items}\r\n            </ul>\r\n        </aside>\r\n    )\r\n}\r\n\r\n// export default Filter","import Tabs from './sort'\r\nexport default Tabs","import React from 'react'\r\n\r\nimport './sort.css'\r\n\r\nexport default function Sort({ sortData, onSortClick, loading }) {\r\n    const renderSortItems = () => {\r\n        return sortData.map(({ title, index, checked }) => {\r\n            return (\r\n                <div\r\n                    className={`tabs__tab ${checked ? \"tabs-selected\" : \"\"}`}\r\n                    onClick={checked ? undefined : () => onSortClick(index)}\r\n                    key={index}>\r\n                    <h1 className=\"tabs__tab-caption\" >\r\n                        {title}\r\n                    </h1>\r\n                </div>\r\n            )\r\n        })\r\n    }\r\n    let classNames = (loading) ? 'tabs disable' : 'tabs'\r\n    return (\r\n        <div className={classNames}>\r\n            {renderSortItems()}\r\n        </div>\r\n    )\r\n}","import React from 'react'\r\n\r\nimport './tickets.css'\r\n\r\nconst Tickets = ({ tickets }) => {\r\n    return (\r\n        <div class=\"tickets\">\r\n            {tickets.map(ticket => <Ticket {...ticket} />)}\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Ticket = ({ price, carrierLogo, segments }) => {\r\n    return (\r\n        <div class=\"tickets__ticket\">\r\n            <div class=\"ticket__header\">\r\n                <h1 class=\"ticket__header-price\">\r\n                    {price}\r\n                </h1>\r\n                <img src={carrierLogo} alt=\"\" class=\"tickets__ticket-logo\" />\r\n            </div>\r\n            <>\r\n                {segments.map(segment => <Segment {...segment} />)}\r\n            </>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Segment = ({ route, time, duration, stopsHeader, stops }) => {\r\n    return (\r\n        <div class=\"segment\">\r\n            <div class=\"segment-item\">\r\n                <div class=\"segment-header\">\r\n                    {route}\r\n                </div>\r\n\r\n                <div class=\"segment-value\">\r\n                    {time}\r\n                </div>\r\n            </div>\r\n            <div class=\"segment-item\">\r\n                <div class=\"segment-header\">\r\n                    В пути\r\n                 </div>\r\n                <div class=\"segment-value\">\r\n                    {duration}\r\n                </div>\r\n            </div>\r\n            <div class=\"segment-item\">\r\n                <div class=\"segment-header\">\r\n                    {stopsHeader}\r\n                </div>\r\n                <div class=\"segment-value\">\r\n                    {stops.join(',')}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Tickets\r\n","import Tickets from './tickets'\r\nexport default Tickets","import React from \"react\"\r\nimport ContentLoader from \"react-content-loader\"\r\n\r\nconst Loader = (props) => (\r\n  <ContentLoader\r\n    speed={2}\r\n    width={502}\r\n    height={184}\r\n    viewBox=\"0 0 502 184\"\r\n    backgroundColor=\"#f3f3f3\"\r\n    foregroundColor=\"#fff\"\r\n    {...props}\r\n  >\r\n    <rect x=\"0\" y=\"5\" rx=\"0\" ry=\"0\" width=\"98\" height=\"36\" />\r\n    <rect x=\"360\" y=\"5\" rx=\"10\" ry=\"10\" width=\"99\" height=\"36\" />\r\n    <rect x=\"0\" y=\"60\" rx=\"0\" ry=\"0\" width=\"459\" height=\"20\" />\r\n    <rect x=\"0\" y=\"104\" rx=\"0\" ry=\"0\" width=\"459\" height=\"20\" />\r\n  </ContentLoader>\r\n)\r\n\r\nexport default Loader\r\n\r\n","import React from 'react';\r\nimport Loader from './loader'\r\n\r\nimport './loader.css'\r\nconst TicketsLoader = (props) => {\r\n    const { count } = props\r\n    return (\r\n        <div className=\"tickets\">\r\n            {\r\n                [...Array(count)].map((e, i) => (\r\n                    <div className=\"tickets__ticket\" key={i}>\r\n                        <Loader />\r\n                    </div>\r\n                ))\r\n            }\r\n        </div>\r\n    )\r\n\r\n\r\n}\r\nexport default TicketsLoader\r\n","export default class AviasalesServices {\r\n    __apiBase = 'https://front-test.beta.aviasales.ru'\r\n\r\n    async getResource(url) {\r\n\r\n        const res = await fetch(`${this.__apiBase}${url}`);\r\n\r\n        if (res.status === 500) {\r\n            return { tickets: [{}], stop: false }\r\n        }\r\n\r\n        if (!res.ok) {\r\n            throw new Error(`Could not fetch ${url} , received ${res.status}`)\r\n        }\r\n\r\n        return await res.json();\r\n    }\r\n\r\n\r\n    async getSearchId() {\r\n        const res = await this.getResource(`/search`)\r\n\r\n        return res.searchId;\r\n    }\r\n\r\n    async getTicketPortion(searchId) {\r\n        const res = await this.getResource(`/tickets?searchId=${searchId}`)\r\n        return res\r\n    }\r\n\r\n    async getRawTickets() {\r\n        const searchId = await this.getSearchId();\r\n        let portion = await this.getTicketPortion(searchId);\r\n        let res = [];\r\n        while (!portion.stop) {\r\n            res = [...res, ...portion.tickets]\r\n            portion = await this.getTicketPortion(searchId);\r\n        }\r\n        // remove empty objects before return\r\n        return res.filter(value => Object.keys(value).length !== 0);\r\n\r\n    }\r\n\r\n    async getProcessedTickets(filters, sort) {\r\n        const tickets = await this.getRawTickets();\r\n        let res = [];\r\n\r\n        if (filters[0].checked)\r\n            res = tickets;\r\n        else {\r\n            filters.forEach(filter => {\r\n                if (filter.checked) {\r\n                    let filtered = tickets.filter(ticket => ticket.segments.every(segment => segment.stops.length === filter.stopCount))\r\n                    res = [...res, ...filtered]\r\n                }\r\n            })\r\n        }\r\n\r\n        const sortFunction = sort.find(sort => sort.checked).sortFunction\r\n        res = res.sort(sortFunction)\r\n\r\n\r\n        return res.slice(0, 5).map(this._transformTicket);\r\n\r\n    }\r\n\r\n    _transformTicket(ticket) {\r\n        const arStopCountHeader = ['без пересадок', '1 пересадка', '2 пересадки', '3 пересадки']\r\n\r\n        return {\r\n            price: ticket.price.toLocaleString('ru-ru'),\r\n            carrierLogo: `https://pics.avs.io/99/36/${ticket.carrier}.png`,\r\n            segments: ticket.segments.map(segment => {\r\n                const departureTime = new Date(segment.date);\r\n                let arrivalTime = new Date(segment.date)\r\n                arrivalTime.setMinutes(arrivalTime.getMinutes() + segment.duration)\r\n\r\n                return (\r\n                    {\r\n                        route: `${segment.origin\r\n                            } \\u2013 ${segment.destination} `,\r\n                        time: `${departureTime.toLocaleTimeString('ru-ru', { timeStyle: 'short' })} \\u2013 ${arrivalTime.toLocaleTimeString('ru-ru', { timeStyle: 'short' })} `,\r\n                        duration: `${Math.floor(segment.duration / 60)}ч ${segment.duration % 60}м`,\r\n                        stops: segment.stops,\r\n                        stopsHeader: arStopCountHeader[segment.stops.length],\r\n                    }\r\n                )\r\n            })\r\n\r\n        }\r\n    }\r\n}","import App from './app';\r\n\r\nexport default App;","import React, { Component } from 'react';\r\n\r\nimport Header from '../header/'\r\nimport Filter from '../filter'\r\nimport Sort from '../sort'\r\nimport Tickets from '../tickets'\r\nimport TicketsLoader from '../ticket-loader/tickets-loader'\r\nimport AviasalesServices from '../../services/aviasales-services'\r\n\r\nimport './app.css';\r\n\r\nexport default class App extends Component {\r\n    aviasalesServices = new AviasalesServices();\r\n    state = {\r\n        filters: [\r\n            { title: 'Все', index: -1, checked: true, stopCount: -1 },\r\n            { title: 'Без пересадок', index: 0, checked: false, stopCount: 0 },\r\n            { title: '1 пересадка', index: 1, checked: false, stopCount: 1 },\r\n            { title: '2 пересадки', index: 2, checked: false, stopCount: 2 },\r\n            { title: '3 пересадки', index: 3, checked: false, stopCount: 3 }\r\n\r\n        ],\r\n        sort: [\r\n            {\r\n                title: \"самый дешёвый\", index: 0, checked: true,\r\n                sortFunction: (a, b) => a.price - b.price\r\n            },\r\n            {\r\n                title: \"самый быстрый\", index: 1, checked: false,\r\n                sortFunction: (a, b) => a.segments.reduce((prev, cur) => prev + cur.duration, 0) - b.segments.reduce((prev, cur) => prev + cur.duration, 0)\r\n            }\r\n        ],\r\n        loading: true\r\n    }\r\n    componentDidMount() {\r\n\r\n        this.getTickets();\r\n    }\r\n    componentDidUpdate(prevProps, prevState) {\r\n\r\n        if (JSON.stringify(prevState.filters) !== JSON.stringify(this.state.filters)\r\n            ||\r\n            JSON.stringify(prevState.sort) !== JSON.stringify(this.state.sort)) {\r\n            this.getTickets();\r\n\r\n        }\r\n    }\r\n\r\n    setFilter = (index) =>\r\n        this.setState(prevState => {\r\n            // обходим массив фильтра и меняем checked у выбранного элемента\r\n            let newFilterData = prevState.filters.map(item => {\r\n                if (item.index === index)\r\n                    return { ...item, checked: !item.checked }\r\n                return item\r\n            })\r\n            // Если выбран первый элемент (Все), то синхронизируем все остальные элементы по нему\r\n            // if (index === -1) {\r\n            //     return (\r\n            //         {\r\n            //             filters: newFilterData.map(item => {\r\n            //                 return { ...item, checked: newFilterData[0].checked }\r\n            //             })\r\n            //         }\r\n            //     )\r\n            // }\r\n\r\n\r\n            return { filters: newFilterData }\r\n        }\r\n        )\r\n\r\n    setSort = (index) => {\r\n        this.setState(prevState => {\r\n            const newSortData = prevState.sort.map(item => {\r\n                if (item.index === index)\r\n                    return { ...item, checked: true }\r\n                else\r\n                    return { ...item, checked: false }\r\n            })\r\n            return { sort: newSortData }\r\n        })\r\n\r\n    }\r\n\r\n    getTickets() {\r\n        const { filters, sort } = this.state\r\n        this.setState({ loading: true })\r\n        this.aviasalesServices\r\n            .getProcessedTickets(filters, sort)\r\n            .then((res) => {\r\n                this.setState({ tickets: res, loading: false })\r\n            }\r\n            )\r\n    }\r\n\r\n    render() {\r\n\r\n\r\n\r\n        return (\r\n\r\n            < div className=\"aviasales-app\" >\r\n                <Header />\r\n                <div className=\"app-container\">\r\n                    <Filter filterData={this.state.filters} onFilterClick={this.setFilter} loading={this.state.loading} />\r\n                    <div className=\"column\">\r\n                        <Sort sortData={this.state.sort} onSortClick={this.setSort} loading={this.state.loading} />\r\n                        {this.state.loading ?\r\n                            <TicketsLoader count={5} />\r\n                            :\r\n                            <Tickets tickets={this.state.tickets} />\r\n                        }\r\n\r\n                    </div>\r\n                </div>\r\n\r\n            </div >\r\n        )\r\n    }\r\n}\r\n\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './components/app';\r\n\r\n// import KvirtuService from './services/kvirtu-service'\r\nReactDOM.render(<App />,\r\n  document.getElementById('root'));"],"sourceRoot":""}